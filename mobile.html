async function sendMessage() {
    const input = document.getElementById('msgInput');
    const btn = document.getElementById('sendBtn');
    const status = document.getElementById('status');
    const msg = input.value.trim();

    if (!msg) {
        status.innerText = "請先輸入內容喔！";
        status.className = "error";
        return;
    }

    btn.disabled = true;
    btn.innerText = "傳送中...";
    status.innerText = "";

    try {
        // 使用 Google Apps Script 時，有時會因為 Redirect 導致 response.ok 為 false
        // 但資料其實已經寫入成功。
        await fetch(API_URL, {
            method: 'POST',
            mode: 'no-cors', // 關鍵：避免跨網域預檢(Preflight)問題
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: msg })
        });

        // 由於 no-cors 模式下無法讀取 response 內容，
        // 我們假設只要沒進入 catch 就是成功。
        status.innerText = "傳送成功！字幕即將出現";
        status.className = "success";
        input.value = ""; 

    } catch (error) {
        console.error("Send Error:", error);
        status.innerText = "傳送失敗，請檢查網路連線";
        status.className = "error";
    } finally {
        btn.disabled = false;
        btn.innerText = "送出留言";
        setTimeout(() => { status.innerText = ""; }, 3000);
    }
}
